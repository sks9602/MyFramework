<%@ page language="java" contentType="text/html;  charset=utf-8" pageEncoding="utf-8"%><%@ include file="/jsp/common/include/include_outline.jsp"%><!DOCTYPE html><%-- !DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd" --%><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- 항상 최신화 --><!-- meta http-equiv="Expires" content="-1"> <meta http-equiv="Pragma" content="no-cache"> <meta http-equiv="Cache-Control" content="No-Cache" --> <!-- cache 처리  되는건지 확인 필요..  --><meta http-equiv="Cache-Control" content="private, max-age=3600"><title>Insert title here</title><%@ include file="/jsp/common/include/include_js.jsp"%><%@ include file="/jsp/common/include/include_css.jsp"%><%/* 항상 최신화response.setHeader("Cache-Control","no-store");   response.setHeader("Pragma","no-cache");   response.setDateHeader("Expires",0);  *//* cache 처리  되는건지 확인 필요.. */response.setHeader("Cache-Control", "private, max-age=3600");%><!--  script src="https://rawgit.com/enyo/dropzone/master/dist/dropzone.js"></script><link rel="stylesheet" href="https://rawgit.com/enyo/dropzone/master/dist/dropzone.css" --><!--  preview :  http://fontawesome.io/icons/  --><link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet"><style></style><script type="text/javascript">/*var timer = Ext.create('Utils.IdleTimer', {    timeout: 1000,    listeners: {        idle: function(){            console.log('Application went into idle state');        },        active: function(){            console.log('Application went into active state');        }    }});timer.start();*/// delete Ext.tip.Tip.prototype.minWidth; <-- tip width조정 적용 안됨../** * function의 이름을 확인.. * 호출하는 곳에서는  *     fs_FunctionName(arguments); * 이렇게 호출 해야 함. */function fs_FunctionName(args) {	return args.callee.toString().substr( 0, args.callee.toString().indexOf( "(" ) ).replace("function ", "" );	// alert(arguments.callee.toString().substr( 0, arguments.callee.toString().indexOf( "(" ) ).replace("function ", "" ));} function fs_CallFunctionName(args) {	return args.callee.caller.toString().substr( 0, args.callee.caller.toString().indexOf( "(" ) ).replace("function ", "" );	// alert(arguments.callee.toString().substr( 0, arguments.callee.toString().indexOf( "(" ) ).replace("function ", "" ));}/** * 오류 element에 frame작용 처리 */function fs_Frame( component, color) {	if( typeof(component) == 'string') {		Ext.get(component).frame(color, 1, 0.2).frame(color, 1, 0.2); 	} else {		try {			if( typeof(component) == 'object') {				component.el.frame(color, 1, 0.2).frame(color, 1, 0.2); 			} 		} catch(e) {					}	}}/** * Log 출력 *   level : debug, info, error, undefined	---> fs_HoScriptLog() 로 통합..function fs_FunctionLog(msg, level) {	if( level ) {		alert(arguments.callee.caller.toString() + " ["+ level.toUpperCase() + "]:" + msg);	} else {		alert(arguments.callee.caller.toString() + ":" + msg);	}} */function fs_HoScriptLog(msg, level) {	if( level ) {			// Error		 var ePat = new RegExp('e.*$', 'i'), 		 	// Warn		 	wPat = new RegExp('w.*$', 'i');					if( ePat.test(level)) {			console.error( arguments.callee.caller.toString() + " : " + msg);		} else if( wPat.test(level)) {			console.warn( arguments.callee.caller.toString() + " : " + msg);		} else{			// console.log(arguments.callee.caller.toString() + " : " +msg);			console.log( arguments.callee.caller.toString() + " : " + msg);		}	} else {		// console.log(arguments.callee.caller.toString() + " : " +msg);		console.log( arguments.callee.caller.toString() + " : " + msg);	}}// 도움말 icon관련. TODO tag 변경 고려 : img  -> div(주석부분)// 안됨.. var G_HELP_TIP_TPL      = '<span id="{0}" cls="x-form-item-label-icon-help" sylte="display:inline;cursor:help;width:25px;float:right;padding:1px 1px 5px 1px;" data-qwidth="520" data-qtitle="{1}"  data-qtip="{2}" >&nbsp;</span>';// 안됨.. var G_HELP_TIP_TPL      = '<div class="x-tool x-box-item" style="width: 15px; height: 15px; right: auto; top: 0px; margin: 0px;" id="{0}"><img role="presentation" id="{0}-toolEl" src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" class="x-tool-img x-form-item-label-icon-help"></div>';// var G_HELP_TIP_TPL      = '<img id="{0}" style="cursor:pointer;" src="/s/static/js/ext-4.2/ux/image/icons/comment.png" data-qwidth="520" data-qtitle="{1}"  data-qtip="{2}" ></img>';var G_HELP_TIP_TPL      = '<img id="{0}" style="cursor:pointer;" src="/s/static/js/ext-4.2/ux/image/icons/help.png" data-qwidth="520" data-qtitle="{1}"  data-qtip="{2}" ></img>';var G_HELP_TIP_TPL_ITEM = '<img id="{0}" style="cursor:pointer;" src="/s/static/js/ext-4.2/ux/image/icons/comment.png" data-qwidth="520" data-qtitle="{commentsTitle}"  data-qtip="{comments}" ></img>';/* 알파벳 만 입력 */Ext.form.VTypes['alphanewVal']  = /^[A-Za-z]*$/;
Ext.form.VTypes['alphanewMask'] = /[A-Za-z]/;
Ext.form.VTypes['alphanewText'] = 'Invalid Entry: Only alphabets are allowed.';
Ext.form.VTypes['alphanew'] = function(val) {
     return Ext.form.VTypes['alphanewVal'].test(val);
};
/* 숫자만 입력 */
Ext.form.VTypes['numericposVal'] =   /^[\d]+$/;
Ext.form.VTypes['numericposMask'] = /[\d]/;
Ext.form.VTypes['numericposText'] = 'Invalid Entry: Must be in the format Ex. 1';
Ext.form.VTypes['numericpos'] = function(val){
    return Ext.form.VTypes['numericposVal'].test(val);
};/* 알파벳 + 숫자 입력 */Ext.form.VTypes['alphanumericVal'] =   /^[a-z0-9]+$/i;Ext.form.VTypes['alphanumericMask'] = /^[a-z0-9]+$/i;Ext.form.VTypes['alphanumericText'] = 'Invalid Entry: 영문과 숫자만 입력가능';Ext.form.VTypes['alphanumeric'] = function(val){    return Ext.form.VTypes['alphanumericVal'].test(val);};/* password를 위한 8자리 이상 16자리 이하 영문, 숫자, 특수문자 조합 */Ext.form.VTypes['passwordVal'] = /^(?=.*[a-zA-Z])(?=.*[!@#$%^*+=-])(?=.*[0-9]).{8,16}$/;Ext.form.VTypes['passwordMask'] = /^(?=.*[a-zA-Z])(?=.*[!@#$%^*+=-])(?=.*[0-9]).{8,16}$/;Ext.form.VTypes['passwordText'] = 'Invalid Entry: 8자리 이상 16자리 이하의 영문, 숫자 및 특수문자 조합';Ext.form.VTypes['password'] = function(val){    return Ext.form.VTypes['passwordVal'].test(val);};/* 이미지 file 컴포넌트 확장자 */Ext.form.VTypes['imageFileUploadVal'] = /^.*\.(gif|png|bmp|jpg|jpeg)$/i;Ext.form.VTypes['imageFileUploadMask'] = /^.*\.(gif|png|bmp|jpg|jpeg)$/i;Ext.form.VTypes['imageFileUploadText'] = 'Image must be in .gif,.png,.bmp,.jpg,.jpeg format';Ext.form.VTypes['imageFileUpload'] = function(val){    return Ext.form.VTypes['imageFileUploadVal'].test(val);};/* 오디오 file 컴포넌트 확장자 */Ext.form.VTypes['audioFileUploadVal'] = /^.*\.(mp3)$/i;Ext.form.VTypes['audioFileUploadMask'] = /^.*\.(mp3)$/i;Ext.form.VTypes['audioFileUploadText'] = 'Audio must be in .mp3 format';Ext.form.VTypes['audioFileUpload'] = function(val){    return Ext.form.VTypes['audioFileUploadVal'].test(val);};/* 비디오 file 컴포넌트 확장자 */Ext.form.VTypes['videoFileUploadVal'] = /^.*\.(avi|mp4)$/i;Ext.form.VTypes['videoFileUploadMask'] = /^.*\.(avi|mp4)$/i;Ext.form.VTypes['videoFileUploadText'] = 'Audio must be in .avi,.mp4 format';Ext.form.VTypes['videoFileUpload'] = function(val){    return Ext.form.VTypes['videoFileUploadVal'].test(val);};    /* 이미지 file 컴포넌트 확장자 */Ext.form.VTypes['fileUploadVal'] = /^.*\.(exe|php|cgi|jsp|asp|htm|bat|msi|vbs|cmd|jar).*$/i;Ext.form.VTypes['fileUploadMask'] = /^.*\.(exe|php|cgi|jsp|asp|htm|bat|msi|vbs|cmd|jar).*$/i;Ext.form.VTypes['fileUploadText'] = '실행가능한 파일은 안됩니다. ex) .exe, .php, .cgi, .jsp, .asp 등';Ext.form.VTypes['fileUpload'] = function(val){    return !Ext.form.VTypes['fileUploadVal'].test(val);};/** * Grid Editor위치 bug수정 * Align editors in grids to the top of the cell, * and not to the middle of the contents. */Ext.override (Ext.grid.CellEditor, {    alignment: "tl-tl"});/* *  Grid Column cellclick event에서 -1 return관련 debug  */Ext.override(Ext.grid.column.Column, {    getVisibleIndex: function() {    	// console.log("here >> ");        return this.isGroupColumn ? false : Ext.Array.indexOf(this.getOwnerHeaderCt().getVisibleGridColumns(), this);    }});/** * Grid cellclick event시 cell에서 -1 return되는 경우 해결 */Ext.override(Ext.view.Table, {	    getHeaderByCell: function(cell) {        if (cell) {        	var cellClassName = cell.className + ' '; // whitespace 추가            // var match = cell.className.match(this.cellRe); // original            var match = cellClassName.match(this.cellRe);  // bug해결..                     if (match && match[1]) {                return this.ownerCt.columnManager.getHeaderById(match[1]);            }        }        return false;    }});/** * deprecated   * Store에 submit() function을 추가 하였으나. * 아래의 Ext.panel.Panel에  submit() function이 추가되이 이 override된 기능은 더이상 사용 하지않음.. * * setPageSize는 사용 함.(pageSize를 수정) */Ext.override(Ext.data.AbstractStore, {	submit : function(option) {    	var me = this, noQuestion = option&&option['noQuestion'], records = this.getModifiedRecords();    	var msgTxt = option.msgTxt||'저장하시겠습니까?';    	if( records.length > 0 ) {    		if (noQuestion) {    			me.sync(option);	 			    			    		} else {		    	hoConfirm( msgTxt , function(btn, text, opt) { 		    		if( btn == 'yes' ) {		    			var mBox = Ext.MessageBox;		    					    			mBox.show({			 		           msg: 'Saving your data, please wait...',			 		           progressText: 'Saving...',			 		           width:300,			 		           wait:true,			 		           waitConfig: {interval:200},			 		           icon:'ext-mb-download', //custom class in msg-box.html			 		           iconHeight: 50			 		    });		    					    			me.sync(option);	 						 					    			setTimeout(function(){			 				mBox.hide();			 	        }, 3000);			 					    		}		    	});    		}    	} else {    		if (noQuestion) {    			Ext.create('widget.uxNotification', {     				title: '알림',    				position: 'br',    				manager: 'form1',    				iconCls: 'ux-notification-icon-information',     				autoCloseDelay: 3000,    				spacing: 20,    				html: '변경된 내용이 없습니다.'    			}).show();    		} else {    			hoAlert('변경된 내용이 없습니다.', Ext.exptyFn, 2000);    		}    	}	},	/**	 * 페이지 사이즈 설정.	 */	setPageSize : function(pageSize) {		var me = this;				me.pageSize = pageSize;	}});Ext.override(Ext.panel.Panel, {   // Ext.grid.Panel	/**	 *  submitType 	 *     1. 'changed' : Grid중 변경된 내용을 submit	 *     2. 'checked' : Grid중 selected 된 내용을 submit 	 *     3. 'all' : Grid의 모든 내용을 submit 	 */	submit : function(submitType, actionFlag, option) {		    	var me = this, store = this.getStore(), noQuestion = (option||{}).noQuestion, records;    	var msgTxt = (option||{}).msgConfirm||'저장하시겠습니까?';    	// 변경된 내용을 submit    	if( submitType.toLowerCase() == 'changed' ) {    		records = store.getModifiedRecords();    	}     	// selected 된 내용을 submit     	else if( submitType.toLowerCase() == 'checked' ) {    		records = this.getSelectionModel().getSelection();    	}    	// Grid의 모든 내용을 submit     	else if( submitType.toLowerCase() == 'all' ) {    		records = store.getRange(0, store.getCount( ) );    	}    	// 이외는 오류    	else {    		hoAlert('구분자가 정확하지 않습니다.(changed/checked)', Ext.exptyFn, 2000);    	}		    	if( !actionFlag || typeof(actionFlag) != 'string') {    		hoAlert('기능이 정확하지 않습니다.', Ext.exptyFn, 2000);    	}    	    	/*    	 * (내부 함수)    	 * 저장 처리    	 */    	function  fs_submit() {    		// 변경된 내용을 submit			if( submitType.toLowerCase() == 'changed' || submitType.toLowerCase() == 'all' ) {								store.proxy.writer.params = { 'p_action_flag' : actionFlag };								Ext.applyIf(option||{}, {					callback : function(batch, option) {						store.reload()					}, 					success : function(batch, option) {						Ext.Msg.alert('Success',  getResultMessageGrid(batch, option)); // batch.operations[0].request.scope.reader.jsonData.message );					}, 					failure : function(batch, option) {						Ext.Msg.alert('Fail',  getResultMessageGrid(batch, option));					}				});				store.sync(option);			} 			// selected 된 내용을 submit 			else if( submitType.toLowerCase() == 'checked' ) {	    		var params = { 'p_action_flag' : actionFlag };    				    		var keys = [];	    			    		for(var key =0; key< records[0].fields.length; key++){	    			keys.push(records[0].fields.get(key)['name'] );	    		}	    		for(var k=0;k < keys.length;k++){	    			params[keys[k]] = params[keys[k]]||[];	    			for(var j=0;j < records.length;j++){	    				params[keys[k]].push(records[j].get(keys[k]));	    			}	    		}  			    		option = Ext.applyIf({	    			url: store.proxy.url,	    			method: 'POST',	    			params: params	    		}, option||{});	    			    		Ext.applyIf(option, {					success : function(response) {						Ext.Msg.alert('Success',  response.responseText.message ); 												store.reload();					}, 					failure : function(response) {						Ext.Msg.alert('Fail',  response.responseText.message );												store.reload();					}				});	    		Ext.Ajax.request(option);	    	}  	    	}    	if( records.length > 0 ) {    		// 묻지 않고 바로 저장..    		if (noQuestion) {    			// 저장 처리 (내부 함수)    			fs_submit()	    			    		} else {		    	hoConfirm( msgTxt , function(btn, text, opt) { 		    		if( btn == 'yes' ) {		    			var mBox = Ext.MessageBox;		    					    			mBox.show({			 		           msg: 'Saving your data, please wait...',			 		           progressText: 'Saving...',			 		           width:300,			 		           wait:true,			 		           waitConfig: {interval:200},			 		           icon:'ext-mb-download', //custom class in msg-box.html			 		           iconHeight: 50			 		    });		    			// 저장 처리 (내부 함수)		    			fs_submit();		    					    			setTimeout(function(){			 				mBox.hide();			 	        }, 3000);			 					    		}		    	});    		}    	} else {    		// 묻지 않고 바로 저장..    		if (noQuestion) {    			Ext.create('widget.uxNotification', {     				title: '알림',    				position: 'br',    				manager: 'form1',    				iconCls: 'ux-notification-icon-error',     				autoCloseDelay: 3000,    				spacing: 20,    				html: '변경된 내용이 없습니다.'    			}).show();    		} else {    			hoAlert('변경된 내용이 없습니다.', Ext.exptyFn, 2000, this.getId());	    		// checkbox에 선택하라는 경고...	    		if( submitType == 'checked' ) {	    			var column = this.down('gridcolumn'); 	    			// Ext.get(column.getId() + '-titleEl').frame('blue', 1, 0.2).frame('blue', 1, 0.2);	    			Ext.get(column.getId()).frame('blue', 1, 0.2).frame('blue', 1, 0.2); 	    		}    		}    	}	},	getSelectedRecords : function() {		return this.getSelectionModel().getSelection();	},	getNewRecords : function() {		var store = this.getStore();    	return store.getNewRecords();	},	getModifiedRecords : function() {		var store = this.getStore();    	return store.getModifiedRecords();	},	getRemovedRecords : function() {		var store = this.getStore();    	return store.getRemovedRecords();	},	getTouchedRecords : function() {		var store = this.getStore(), records = new Array;		records.concat( store.getNewRecords() );		records.concat( store.getModifiedRecords() );		records.concat( store.getRemovedRecords() );		return records;	}});Ext.override(Ext.data.TreeStore, {    hasFilter: false,    /**    * Filters the current tree by a function fn    * if the function returns true the node will be in the filtered tree    * a filtered tree has also a flat structure without folders    */    filterBy : function(fn, scope) {        var me    = this,        nodes = [],        root  = me.getRootNode(),        tmp;        // the snapshot holds a copy of the current unfiltered tree        me.snapshot = me.snapshot || root.copy(null, true);        tmp = me.snapshot.copy(null, true);        var childNodes = tmp.childNodes;        root.removeAll();        for( var i=0; i < childNodes.length; i++ ) {            //Recursively tranverse through the root and adds the childNodes[i] if fn returns true			if( this.traverseNode( childNodes[i], root, fn ) == true ) {				i--;			}        }        return me;    },    /**    * Recursively tranverse through the root and adds the childNodes[i] if fn returns true    */    traverseNode: function( node, parentNode, fn ) {        var me = this;        if( fn.call( me, node ) ) {            parentNode.appendChild( node );            return true;        }        if( node.hasChildNodes() ) {            var childNodes = node.childNodes;            var found = false;            for( var i=0; i < childNodes.length; i++ ) {                if( this.traverseNode( childNodes[i], node, fn ) == true ) {                    found = true;                }            }            if( found == true ) {                parentNode.appendChild( node );                return true;            }        }        return false;    },    /**    * Clears all filters a shows the unfiltered tree    */    clearFilter : function() {        var me = this;        if (me.isFiltered()) {            me.setRootNode(me.snapshot);            delete me.snapshot;        }        return me;    },    /**    * Returns true if the tree is filtered    */    isFiltered : function() {        return !!this.snapshot;    }});/** * Form에서 처리 결과 message 가져오기. */function getResultMessageForm( form, action ) {	return  action.result.message;}/** * Form에서 처리 결과 message 가져오기. */function getResultMessageGrid( batch, option ) {	return batch.operations[0].request.scope.reader.jsonData.message;}function rowspanRenderer(value, meta, record, rowIndex, colIndex, store) {	var getId = this.dataIndex; // 'industry'	var first = !rowIndex || value !== store.getAt(rowIndex - 1).get(getId),	    last = rowIndex >= store.getCount() - 1 || value !== store.getAt(rowIndex + 1).get(getId);	meta.css += 'row-span' + (first ? ' row-span-first' : '') +  (last ? ' row-span-last' : '');	if (first) {		var i = rowIndex + 1;		while (i < store.getCount() && value === store.getAt(i).get(getId)) {			i++;		}		var rowHeight = 20, padding = 6,			height = (rowHeight * (i - rowIndex) - padding) + 'px';		meta.attr = 'style="height:' + height + ';line-height:' + height + ';"';	}	return first ? value : '';}function renderBool(val) {    var checkedImg   = '/s/static/js/ext-4.2/resources/ext-theme-classic/images/menu/checked.gif';    var uncheckedImg = '/s/static/js/ext-4.2/resources/ext-theme-classic/images/menu/unchecked.gif';    var cb = ''        + '<div style="text-align:center;height:13px;overflow:visible">'        + '<img style="vertical-align:-3px" src="'        + (val ? checkedImg : uncheckedImg)        + '"'        + ' />'        + '</div>'    ;    return cb;}  function getParam(scope, _p_action_flag, opts) {	// var param = Ext.apply(scope.up('form').getForm().getFieldValues(), {p_action_flag : _p_action_flag} _);	var param = scope.up('form').getForm().getFieldValues();	Ext.apply(param, {p_action_flag : _p_action_flag});	if( opts ) {		Ext.apply(param, opts);	}	return param;}/* * 엑셀 다운로드 / 파일 다운로드 공통 처리 부분  */function fs_DownloadCommon(gbn) {	var checkupActionFlag = '', progressText = '';	var msg = '';		switch(gbn) {		case 'excel' :			checkupActionFlag = 'r_excel_down_progress';			msg = 'Excel Downloading...';			progressText = 'Loading Data...';			break;		case 'file' :			checkupActionFlag = 'r_down_progress';			msg = 'File Downloading...';			progressText = 'Reading File....';			break;		default :			checkupActionFlag = 'r_down_progress';			msg = 'Downloading...';			progressText = 'Reading....';			break;				}	/*	if( gbn == 'excel' ) {		checkupActionFlag = 'r_excel_down_progress';		msg = 'Excel Downloading...';		progressText = 'Loading Data...';	} else if( gbn == 'file' ){		checkupActionFlag = 'r_down_progress';		msg = 'File Downloading...';		progressText = 'Reading File....';	}	*/	Ext.MessageBox.show({	    title: 'Please wait',	    msg: msg ,	    progressText: progressText,	    width:300,	    progress:true,	    closable:false	});	var runner = new Ext.util.TaskRunner(),	task = runner.newTask({	     run: function () {	    		Ext.Ajax.request({	        		url: '/s/example/file.do?p_action_flag='+checkupActionFlag,	        		method: 'POST',	        		success : function(response,options){	        			var percentage =  Ext.decode(response.responseText).percentage ;	        			var message = Ext.decode(response.responseText).message	        			if( percentage!=0 ) {	        				Ext.MessageBox.updateProgress(percentage/100, percentage+'% completed');	        			}	        			// 완료시	        			if( percentage >= 100 ) {	        				try {	        					task.stop();	        					task.destroy();	        				} catch(e) {	        					alert('task.destroy' +e);	        				}	        					        				// 메시시 박스 사라지게..	        				Ext.Function.defer(function() {	        						        					Ext.MessageBox.hide();	        						        					Ext.Ajax.request({	        						url: '/s/example/file.do?p_action_flag='+checkupActionFlag+'&destroy=true',	        						method: 'POST'	        					});	        						        				}, 1000);	        					        			} 	        			//오류 발생시	        			else if( percentage < 0 ) {	        				try {	        					task.stop();	        					task.destroy();	        				} catch(e) {	        					alert('task.destroy' +e);	        				}	        				if( !message ) {	        					message = 'Canceled.';	        				}	        					        				Ext.MessageBox.updateProgress(0, message );	        				// 메시시 박스 사라지게..	        				Ext.Function.defer(function() {	        						        					Ext.MessageBox.hide();	        						        					Ext.Ajax.request({	        						url: '/s/example/file.do?p_action_flag='+checkupActionFlag+'&destroy=true',	        						method: 'POST'	        					});	        						        				}, 1000);		        			}	        		},	        		failure: function(){	        				        		},	        		scope: this	        	});	     },	     interval: 1000	 });		task.start();	}/** * 엑셀 다운로드 Global함수.. */function fs_ExcelDownLoad(excelSeq) {	Ext.get("id_download").dom.src = '/s/example/file.do?p_action_flag=r_download_excel';	fs_DownloadCommon('excel');}/** * 파일 다운로드 Global함수.. */function fs_FileDownLoad(fileGroupSeq) {	Ext.get("id_download").dom.src = '/s/example/file.do?p_action_flag=r_download_file';	fs_DownloadCommon('file');	}function fs_goLoginPage () {	alert('로그인 페이지로 이동');}/* * 도움말 클릭시 */function onItemHelpClick(e, t, eOpts, cmp) {	var win = Ext.getCmp('comments-window');	var helpImg = Ext.get(t);		if( !win ) {		win = Ext.create('Ext.window.ux.WindowHelp', {			title: cmp.fieldLabel+'의 Comments 수정 ',	    	x : helpImg ? (helpImg.getX()+helpImg.getWidth()-2) : e.getX(),	    	y : helpImg ? (helpImg.getY()+helpImg.getHeight()-5) : e.getY(),	    	targetField : cmp,	    	target : t	    });	} else {		win.setTitle(cmp.fieldLabel+'의 Comments 수정 ');		//win.setX(helpImg ? (helpImg.getX()+helpImg.getWidth()-2) : e.getX());		//win.setY(helpImg ? (helpImg.getY()+helpImg.getHeight()-5) : e.getY());		win.setTargetField(cmp);		win.setTarget(t);				Ext.getCmp('comments-window-comments').setValue( t.getAttribute('data-qtip') );	}	win.show();	try {		win.alignTo(t, "bl");	} catch(e) {		alert(e);	}}/** * item 오른쪽 마우스 버튼 클릭시 */function onItemContextMenu(e, t, eOpts, cmp) {	var items = new Array;	// items.push(config.fieldLabel);	items.push(Ext.create('Ext.Action', {        iconCls : 'btn-icon-tree-add-first-level',        text: '도움말 보기',        handler: function(widget, event) {        	alert('도움말 보기');          }    }));	items.push(Ext.create('Ext.Action', {        iconCls : 'btn-icon-tree-add-first-level',        text: '도움말 추가/수정',        handler: function(widget, event) {        	try {        		onItemHelpClick(e, t, eOpts, cmp);        		        	} catch(e) {        		alert(e);        	}        }    }));	items.push(Ext.create('Ext.Action', {        iconCls : 'btn-icon-tree-add-first-level',        text: '도움말 삭제',        handler: function(widget, event) {        	// @TODO DB삭제 로직 추가        	alert(cmp.up('form').getId());        	alert(cmp.getId());        	Ext.get(cmp.getId()+'-help').remove();        }    }));	// 검색조건 영역일 경우	if(cmp.getId().indexOf("search")>=0 ) {		items.push('-');		items.push(Ext.create('Ext.Action', {	        iconCls : 'btn-icon-tree-add-first-level',	        text: '최근 검색 목록 보기',	        handler: function(widget, event) {	        	alert('최근 검색 목록 보기');  	        }	    }));		items.push(Ext.create('Ext.Action', {	        iconCls : 'btn-icon-tree-add-first-level',	        text: '최근 검색 목록 모두 삭제',	        handler: function(widget, event) {	        	alert('최근 검색 목록 모두 삭제');  	        }	    }));	}		var contextMenu = Ext.create('Ext.menu.Menu', {				        items: items					});		contextMenu.showAt(e.getXY());}<% String striptOutJsp = incBodyJSP + "&division=script_out"; %><jsp:include page="<%=incBodyJSP%>"  flush="false">	<jsp:param name="division" value="script_out"/>	<jsp:param name="type" value=""/></jsp:include>Ext.onReady(function() {		Ext.QuickTips.init();	function onItemCheck(item, checked){	}	var viewport = Ext.create('Ext.Viewport', {	    id: 'border-example',	    layout: 'border',	    items: [ Ext.create('Ext.Toolbar', {	    	region: 'north',			// ui: 'header',			margins : '5 5 5 5',			items : [{	text: 'Radio Options',						menu: {					        xtype: 'menu',					        items: [{					                text: 'Menu One',					                iconCls: 'edit'					            }, {					                text: 'Menu Two',					                menu: {					                    xtype: 'menu',					                    items: [{					                        text: 'Next Level'					                    },{					                        text: 'Next Level'					                    },{					                        text: 'Next Level',					                        	menu: {								                    xtype: 'menu',								                    items: [{								                        text: 'Next Level2-1'								                    },{								                        text: 'Next Level2-2'								                    },{								                        text: 'Next Level2-3'								                    }]								                }					                    }]					                }					            }, {					                text: 'Menu Three',					                scale: 'small'					            }, {					                text: 'Menu Four',					                scale: 'small'					        }]					    }					}, {text: 'Radio Options',						menu: {        // <-- submenu by nested config object						    items: [						        {						            text: 'Aero Glass',						            checked: true,						            group: 'theme',						            checkHandler: onItemCheck						        }, {						            text: 'Vista Black',						            checked: false,						            group: 'theme'						        }, {						            text: 'Gray Theme',						            checked: false,						            group: 'theme',						            checkHandler: onItemCheck						        }, {						            text: 'Default Theme',						            checked: false,						            group: 'theme',						            checkHandler: onItemCheck						        }						    ]						}				}, '|', '->', {					xtype : 'button',					id : 'id_top_calendar_btn',					text : '달력',					listeners : {						click : function() {							top.location.href = "/s/static/js/calendar/index.html?theme=classic";						}					}				}, '|']	        }),	        Ext.widget('tabpanel', {	        	id : 'id_main_tabpanel',                cls : 'main_tabpanel',	        	region: 'center',	        	margins: '0 5 5 0',	        	border : true,	        	title : '메뉴명 또는 선택된 item',	        	window : {	        		popupMember : Ext.create('Ext.window.ux.WindowPopupMember',{	        			fields : ['COMPANY_ID_NM'],	        			empty : null	        		})	        	},	        	// 2015.02.06 bodyStyle: 'padding:5px',	        	/*			    plugins: [{			        ptype: "headericon",			        height: 15,			        width: 15,			        headerButtons : [			            {			                xtype: 'button',			                id : 'id_wanna_to_modify',			                text : '2',			                iconCls: 'icon-toolbar-indicator',			                scope: this,			                handler: function(){ alert(1); }			            }			        ]			    }],			    */			    tools:[			    	{						type:'help',						id : 'id_main_tabpanel_help',						handler: function(event, toolEl, panelHeader) {							var win = Ext.getCmp("id_main_top_win_help");														if( !win ) {					        	 // win = DevelopeManger.js					        	 	try {										win = Ext.create('Ext.window.ux.Help',{											title: 'Help ',											menuId : 'aa'										});					        	 	} catch(e) {					        	 		alert(e);					        	 	}					        						        	} 								win.show('id_main_tabpanel_help');								win.setWidth(1200);								win.expand(true);													}			    	},{						type:'gear',						tooltip: 'Checkup...',						tplWriteMode : 'overwrite', 						id : 'id_main_tabpanel_gear',				        // hidden:true,						handler: function(event, toolEl, panelHeader) {							var win = Ext.getCmp("id_main_top_win_develop_status");							if( !win ) {				        	 // win = DevelopeManger.js				        	 	try {									win = Ext.create('Ext.window.ux.DevelopeManger',{										title: '개발 진행 상태 ',										role : 'PM', // TESTER, DEVELOPER, 										memberId : 'sks9602',										menuId : 'A1001'									});				        	 	} catch(e) {				        	 		fs_FunctionLog("Outline.all_in_one.jsp : " + e, "ERROR");				        	 	}				        					        	} 							win.setMemberId('sks9602');							win.setMenuId('A1002');							win.show('id_main_tabpanel_gear');						//if( win.getCollapsed() ) {							win.setWidth(1400);							win.expand(true);							// win.tools['restore'].hide();							// win.tools['minimize'].show();						//}				        					    	}			    	}			    ],			    	        	defaults: {	        	    autoScroll: false	            },	            listeners : {	            	resize : function (_this) {	        			//alert(_this.getActiveTab().nextNode('grid').getX(true));	            	},	            	tabchange : function (_this, _newCard ) {	            		//alert(_newCard.nextNode('grid').getX(true));	            		// Comments Window닫기..	            		var win = Ext.getCmp('comments-window');	            		if( win ) {	            			win.close();	            		}	            	},	            	activate :  function (_this ) {	            		//alert(3);	            	}	            },	        	items : [	<% String striptJsp = incBodyJSP + "&division=script&type=main"; %>	<jsp:include page="<%=incBodyJSP%>"  flush="false">		<jsp:param name="division" value="script"/>		<jsp:param name="type" value="main"/>	</jsp:include>				]	        }) //end id_main_tabpanel item	,	            {	            	xtype: 'tabpanel',	                region: 'west',	                id : 'id_main_west_panel',	                title: 'Menu ~~',	                dockedItems: [{	                    dock: 'top',	                    xtype: 'toolbar',	                    items: [ '->', {	                       xtype: 'button',	                       text: 'test',	                       tooltip: 'Test Button',	                       listeners : {	                    	   click : function() {	                    		   /*	                    		   var prc = new Array(),p;	                    		   function creatHtml(idx, t, s) {	                    			   var tpl = '<div class="process" id="id_process_idx_{0}"><h3>{1}</h3><p>{2}</p></div>';	                    			   return Ext.String.format(tpl, idx, t, s);	                    		   }	                    		   var data = [[1, 'Title1', '이만큼 진행'], [2, 'Title2', '그  만큼 진행'], [3, 'Title3', '삼 만큼 진행'] ];	                    		   	                    		   Ext.get('process-div').select('div').remove();	                    		   	                    		   for( var i=0; i<data.length; i++ ){	                    			   p = Ext.DomHelper.append(Ext.getDom('process-div'),creatHtml(data[i][0], data[i][1], data[i][2]), true);	                    			   if( i!= data.length-1) {	                    				   p = Ext.DomHelper.append(Ext.getDom('process-div'),'<div class="arrow-down">', true);	                    			   }	                    		   }                    			   //prc.join('').slideIn('t');                    			   */	                    		   var tpl = new Ext.XTemplate(	                    				   "<tpl for='.'>",		                    				   "<div id='id_process_idx_title''>[ {name} ]</div>",		                    				   "<tpl for='datas'>",			                    				    "<div class='process' id='id_process_idx_{[xindex]}'  onclick='alert({idx})'>",			                    				    	"<h3>[{[xindex]}] - {title}</h3>",			                    				    	"<p>{status}</p>",			                    				    "</div>",			                    				    "<tpl if='this.isNotFinal(xindex, xcount)'>",			                    				    	"<div class='arrow-down'></div>",			                    				    "</tpl>",		                    				    "</tpl>",		                    				"</tpl>",	                    				    {	                    				    	isNotFinal : function(xindex, xcount) {	                    				    		return xindex < xcount;	                    				    	}	                    				    }	                    				);                    			   var data = {name : 'CourseName',                     					   		datas : [                    					   		    {idx:1, title:'Title1', status:'이만큼 진행'}, {idx:2, title:'Title2', status:'그  만큼 진행'}, {idx:3, title:'Title3', status:'삼 만큼 진행'},                    					   		    {idx:1, title:'Title1', status:'이만큼 진행'}, {idx:2, title:'Title2', status:'그  만큼 진행'}, {idx:3, title:'Title3', status:'삼 만큼 진행'},	                    					   		{idx:1, title:'Title1', status:'이만큼 진행'}, {idx:2, title:'Title2', status:'그  만큼 진행'}, {idx:3, title:'Title3', status:'삼 만큼 진행'},	                    					   		{idx:1, title:'Title1', status:'이만큼 진행'}, {idx:2, title:'Title2', status:'그  만큼 진행'}, {idx:3, title:'Title3', status:'삼 만큼 진행'},	                    					   		{idx:1, title:'Title1', status:'이만큼 진행'}, {idx:2, title:'Title2', status:'그  만큼 진행'}, {idx:3, title:'Title3', status:'삼 만큼 진행'},	                    					   		{idx:1, title:'Title1', status:'이만큼 진행'}, {idx:2, title:'Title2', status:'그  만큼 진행'}, {idx:3, title:'Title3', status:'삼 만큼 진행'},	                    					   		{idx:1, title:'Title1', status:'이만큼 진행'}, {idx:2, title:'Title2', status:'그  만큼 진행'}, {idx:3, title:'Title3', status:'삼 만큼 진행'},	                    					   		{idx:1, title:'Title1', status:'이만큼 진행'}, {idx:2, title:'Title2', status:'그  만큼 진행'}, {idx:3, title:'Title3', status:'삼 만큼 진행'}                    					   			]                    			  				};	                    		   var m = tpl.overwrite('process-div', data, true);	                    		   // m.hide();	                    		   // m.slideIn('t');	                    	   }	                       }	                    }]	                }],	                animCollapse: true,	                collapsible: true,	                split: true,	                width: 225, // give east and west regions a width	                minSize: 175,	                maxSize: 400,	                margins: '0 0 5 5',	                activeTab: 0,	                tabPosition: 'bottom',	                items: [Ext.create('Ext.tree.Panel', {                        title: 'Menu Tree',                        id : 'id_west_menu_view',                        width: 200,                        height: 150,                        store: Ext.create('Ext.data.TreeStore', {    	                        root: {    	                            expanded: true,    	                            children: [    	                                { text: "detention", leaf: true },    	                                { text: "homework", expanded: true, children: [    	                                    { text: "book report", leaf: true },    	                                    { text: "algebra", leaf: true}    	                                ] },    	                                { text: "buy lottery tickets", leaf: true }    	                            ]    	                        }    	                    }),                        rootVisible: true                    }),                    {                    	xtype: 'panel',                    	 title: '현황 조회',                    	 id : 'id_west_accordion_view',                    	 layout: {                    		 	type: 'accordion',                    		 	// multi : true,                    	        animate: true                    	},                    	items: [							{							    html: '최근 본 목록',							    title: '최근 본 목록',							    xtype : 'grid',							    id : 'id_west_history_view',							    autoScroll: true   ,							    store: Ext.create('Ext.data.Store', {							        fields:['name', 'email'],							        data:{'items':[							            { 'name': 'Lisa',  "email":"lisa@simpsons.com"  },							            { 'name': 'Bart',  "email":"bart@simpsons.com" },							            { 'name': 'Homer', "email":"home@simpsons.com"  },							            { 'name': 'Marge', "email":"marge@simpsons.com"  }							        ]},							        proxy: {							            type: 'memory',							            reader: {							                type: 'json',							                root: 'items'							            }							        }})							    ,								    columns: [							              { text: '과정명',  dataIndex: 'name' },							              { text: '검색일시', dataIndex: 'email', flex: 1 }							          ]							},       		                    {			                    html: 'Select [test] button on top tool.. or Drag & Drop from grid.. <div id="process-div"></div>',			                    title: 'Process',			                    xtype : 'panel',			                    id : 'id_west_process_view',			                    autoScroll: true   				                }						]                    },	                Ext.create('Ext.grid.PropertyGrid', {	                        title: 'Property Grid',	                        id : 'id_west_property_view',	                        closable: true,  	                        sourceConfig: {	                            '메뉴 위치': { 	                            	editor : Ext.create('Ext.form.ComboBox', {		                                name        : 'category',		                                allowBlank     : false,		                                store        : ['상단', '상단+좌측', '좌측'],		                                typeAhead    : true,		                                mode        : 'local',		                                triggerAction    : 'all',		                                emptyText    :'-- Select --',		                                selectOnFocus    :true	                               })	                        	},'날짜 표시': { 	                            	editor : Ext.create('Ext.form.ComboBox', {		                                name        : 'category',		                                allowBlank     : false,		                                store        : ['Y/m/d', 'm/d/Y', 'Y/n/j', 'n/j/Y', 'Y/M/d', 'M/d/Y', , 'Y/M/j', 'M/j/Y', 'Y-m-d', 'm-d-Y', 'Y-n-j', 'n-j-Y', 'Y-M-d', 'M-d-Y', , 'Y-M-j', 'M-j-Y'],		                                typeAhead    : true,		                                mode        : 'local',		                                triggerAction    : 'all',		                                emptyText    :'-- Select --',		                                selectOnFocus    :true	                               })	                        	}	                        } ,	                        source: {	                            "도움말 보이기": false,	                            "(검색조건)Checkbox로": false,	                            "(입력화면)Radio로": false,	                            "Grid 컬럼 저장": false,	                            "날짜 표시": 'Y/m/d',	                            "메뉴 위치": '상단+좌측',	                            "(name)": "Properties Grid",	                            "created": Ext.Date.parse('10/15/2006', 'm/d/Y'),	                            "version": 0.01,	                            "borderWidth": 1	                        }	                    }) ],	                listeners : {	                	tabchange : function( tabPanel, newCard, oldCard, eOpts ) {                        	var title = '';                        	switch(newCard.getId()) {                        		case 'id_west_accordion_view' :                        			title = 'Process';                        			break;                        		case 'id_west_property_view' :                        			title = 'Property';                        			break;                        		case 'id_west_menu_view' :                        			title = 'Menu';                        			break;                        		default :                         			break;                        	}                        	tabPanel.setTitle(title);                        		                		if( newCard.getId()  == 'id_west_accordion_view'  && !this.isDropTragetLoaded ) {	                				                			Ext.create('Ext.dd.DropTarget', 'id_west_process_view' , {	                				ddGroup: 'firstGridDDGroup',	                		        notifyEnter: function(ddSource, e, data) {	    	                			// accordion 두번째 선택되게..	    	                			Ext.getCmp('id_west_accordion_view').items.items[1].expand();	                		            	                		        },	                		        notifyDrop  : function(ddSource, e, data){	                		        	var record = ddSource.dragData.records[0].data;	                		        		                		        	makeProcess( record )	                		        		                		        	/*	                		        	var tpl = new Ext.XTemplate(	 		                    				   "<div id='id_process_idx_title'>[ {name} ]</div>",	 		                    				   "<tpl for='datas'>", 	 		                    				  		"<div>[[ {group} ]]</div>",	 		                    				  		"<tpl for='items'>", 		 			                    				    "<div class='process' id='id_process_idx_{[xindex]}'  onclick='fs_v_treelist_클릭(\"{parent.name}\"); fs_AddTab_v_tree_detail({['{']} \"table_name\" : \"{parent.name}\" {['}']} ); fs_AddTab_v_detail_list();'>",		 			                    				    	"<h3>[{[xindex]}] - {title} </h3>",		 			                    				    	"<p>{status}</p>",		 			                    				    "</div>",		 			                    				    "<tpl if='this.isNotFinal(xindex, xcount)'>",		 			                    				    	"<div class='arrow-down'></div>",		 			                    				    "</tpl>", 		 			                    				 "</tpl>",	 		                    				    "</tpl>",	 	                    				    {	 	                    				    	isNotFinal : function(xindex, xcount) {	 	                    				    		return xindex < xcount;	 	                    				    	}	 	                    				    }	 	                    				);	                		        	// Drop된 데이터	                		        	var record = ddSource.dragData.records[0].data;	                		        		                		        	// Process 그리기..	                     				var data = {name : record.table_name, 	                     					   		datas : [	                     					   		        { 	group : 'A Group', 	                     					   		        	items : [			                     					   		    			{idx:1, title:'Title1', status:'이만큼 진행'}, {idx:2, title:'Title2', status:'그  만큼 진행'}, {idx:3, title:'Title3', status:'삼 만큼 진행'},			                     					   		    			{idx:1, title:'Title1', status:'이만큼 진행'}, {idx:2, title:'Title2', status:'그  만큼 진행'}, {idx:3, title:'Title3', status:'삼 만큼 진행'},	 	                    					   						]	                     					   		        },{ 		                     					   		        	group : 'B Group', 	                     					   		        	items : [						 	                    					   		{idx:1, title:'Title1', status:'이만큼 진행'}, {idx:2, title:'Title2', status:'그  만큼 진행'}, {idx:3, title:'Title3', status:'삼 만큼 진행'},						 	                    					   		{idx:1, title:'Title1', status:'이만큼 진행'}, {idx:2, title:'Title2', status:'그  만큼 진행'}, {idx:3, title:'Title3', status:'삼 만큼 진행'}				 	                    					   			]	                     					   		        }, {	                     					   		        	group : 'C Group', 	                     					   		        	items : [						 	                    					   		{idx:1, title:'Title1', status:'이만큼 진행'}, {idx:2, title:'Title2', status:'그  만큼 진행'}, {idx:3, title:'Title3', status:'삼 만큼 진행'},						 	                    					   		{idx:1, title:'Title1', status:'이만큼 진행'}, {idx:2, title:'Title2', status:'그  만큼 진행'}, {idx:3, title:'Title3', status:'삼 만큼 진행'}				 	                    					   			]	                     					   		        },{ 		                     					   		        	group : 'D Group', 	                     					   		        	items : [						 	                    					   		{idx:1, title:'Title1', status:'이만큼 진행'}, {idx:2, title:'Title2', status:'그  만큼 진행'}, {idx:3, title:'Title3', status:'삼 만큼 진행'},						 	                    					   		{idx:1, title:'Title1', status:'이만큼 진행'}, {idx:2, title:'Title2', status:'그  만큼 진행'}, {idx:3, title:'Title3', status:'삼 만큼 진행'}				 	                    					   			]	                     					   		        }	                     					   			]	                     			  				}; 	 	                    		   var m = tpl.overwrite('process-div', data, true);	                		        	*/	                		            return true;	                		        }	                			});		                			this.isDropTragetLoaded = true;	                		}	                	}	                }	            }			]		});	});/**  * Process를 그린다. * var record = ddSource.dragData.records[0].data; */function makeProcess( record ) {	/* Tab 변경 */	var westCmp = Ext.getCmp('id_main_west_panel');	// westCmp.setActiveTab('id_west_process_view');			westCmp.setActiveTab('id_west_accordion_view');	// accordion 두번째 선택되게..	Ext.getCmp('id_west_accordion_view').items.items[1].expand();		var processDiv = Ext.get('id_west_process_view');	// Masking 처리	processDiv.mask("Wait..");		var tpl = new Ext.XTemplate(			   "<div id='id_process_idx_title'>[ {name} ]</div>",			   "<tpl for='datas'>", 			  		"<div>[[ {group} ]]</div>",			  		"<tpl for='items'>",   				    "<div class='process' id='id_process_idx_{[xindex]}'  onclick='fs_v_treelist_클릭(\"{parent.name}\"); fs_AddTab_v_tree_detail({['{']} \"table_name\" : \"{parent.name}\" {['}']} ); fs_AddTab_v_detail_list();'>",  				    	"<h3>[{[xindex]}] - {title} </h3>",  				    	"<p>{status}</p>",  				    "</div>",  				    "<tpl if='this.isNotFinal(xindex, xcount)'>",  				    	"<div class='arrow-down'></div>",  				    "</tpl>",   				 "</tpl>",			    "</tpl>",		    {		    	isNotFinal : function(xindex, xcount) {		    		return xindex < xcount;		    	}		    }		);	// Process 그리기..	var data = {name : record.TNAME, 		   		datas : [		   		        { 	group : 'A Group', 		   		        	items : [				   		    			{idx:1, title:'Title1', status:'이만큼 진행'}, {idx:2, title:'Title2', status:'그  만큼 진행'}, {idx:3, title:'Title3', status:'삼 만큼 진행'},				   		    			{idx:1, title:'Title1', status:'이만큼 진행'}, {idx:2, title:'Title2', status:'그  만큼 진행'}, {idx:3, title:'Title3', status:'삼 만큼 진행'}			   						]		   		        },{ 			   		        	group : 'B Group', 		   		        	items : [          					   		{idx:1, title:'Title1', status:'이만큼 진행'}, {idx:2, title:'Title2', status:'그  만큼 진행'}, {idx:3, title:'Title3', status:'삼 만큼 진행'}  					   			]		   		        }, {		   		        	group : 'C Group', 		   		        	items : [          					   		{idx:1, title:'Title1', status:'이만큼 진행'}, {idx:2, title:'Title2', status:'그  만큼 진행'}, {idx:3, title:'Title3', status:'삼 만큼 진행'},          					   		{idx:1, title:'Title1', status:'이만큼 진행'}  					   			]		   		        }		   			]				}; 	var m = tpl.overwrite('process-div', data, true);	// Masking 없애기 	processDiv.unmask();}<% String striptJsp2 = incBodyJSP + "&division=script&type=sub"; %><!-- jsp:include page="<%=incBodyJSP%>"  flush="false" -->	<!-- jsp:param name="division" value="script"/-->	<!-- jsp:param name="type" value="sub"/--><!-- /jsp:include --></script></head><body><% String htmlJsp = incBodyJSP + "&division=html"; %><!-- jsp:include page="<%=htmlJsp%>" / --><iframe id="id_download" name="download" src="about:blank"></iframe></body></html>